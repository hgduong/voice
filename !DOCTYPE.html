<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Chuyá»ƒn VÄƒn Báº£n & Quay MÃ n HÃ¬nh</title>
  <style>
    body { font-family: sans-serif; max-width: 800px; margin: auto; padding: 20px; }
    textarea, select, input[type=range] { width: 100%; margin-top: 10px; margin-bottom: 10px; }
    button { padding: 10px 15px; margin-right: 10px; }
    video { width: 100%; max-width: 600px; margin-top: 10px; }
    hr { margin: 30px 0; }
  </style>
</head>
<body>

  <h2>ğŸ”Š Chuyá»ƒn VÄƒn Báº£n ThÃ nh Giá»ng NÃ³i</h2>
  <textarea id="textInput" rows="4" placeholder="Nháº­p vÄƒn báº£n táº¡i Ä‘Ã¢y..."></textarea>

  <label for="voiceSelect">Chá»n Giá»ng NÃ³i:</label>
  <select id="voiceSelect"></select>

  <label for="pitch">Cao Ä‘á»™ (Pitch):</label>
  <input type="range" id="pitch" min="0" max="2" step="0.1" value="1">

  <div>
    <button onclick="speakText()">â–¶ï¸ PhÃ¡t Giá»ng NÃ³i</button>
  </div>

  <hr>

  <h2>ğŸ¥ Quay MÃ n HÃ¬nh (cÃ³ tiáº¿ng náº¿u chá»n Ä‘Ãºng)</h2>
  <p><strong>LÆ°u Ã½:</strong> Khi Ä‘Æ°á»£c há»i, hÃ£y chá»n <b>Tab trÃ¬nh duyá»‡t</b> vÃ  Ä‘Ã¡nh dáº¥u vÃ o <b>"Chia sáº» Ã¢m thanh tab"</b>.</p>
  <button onclick="startRecording()">â–¶ï¸ Báº¯t Ä‘áº§u quay</button>
  <button onclick="stopRecording()" disabled id="stopBtn">â¹ Dá»«ng & Táº£i video</button>
  <video id="preview" autoplay muted></video>

  <script>
    // Load danh sÃ¡ch giá»ng nÃ³i
    document.addEventListener("DOMContentLoaded", function () {
      const synth = window.speechSynthesis;
      const voiceSelect = document.getElementById("voiceSelect");

      function populateVoices() {
        const voices = synth.getVoices();
        voiceSelect.innerHTML = "";
        voices.forEach((voice, index) => {
          const option = document.createElement("option");
          option.value = index;
          option.textContent = `${voice.name} (${voice.lang})`;
          voiceSelect.appendChild(option);
        });
      }

      populateVoices();
      if (synth.onvoiceschanged !== undefined) {
        synth.onvoiceschanged = populateVoices;
      }
    });

    // PhÃ¡t giá»ng nÃ³i
    function speakText() {
      const text = document.getElementById("textInput").value;
      const pitch = parseFloat(document.getElementById("pitch").value);
      const voiceIndex = document.getElementById("voiceSelect").value;

      const utterance = new SpeechSynthesisUtterance(text);
      const voices = speechSynthesis.getVoices();
      if (voices[voiceIndex]) utterance.voice = voices[voiceIndex];
      utterance.pitch = pitch;

      speechSynthesis.speak(utterance);
    }

    // Ghi mÃ n hÃ¬nh
    let mediaRecorder;
    let recordedChunks = [];

    async function startRecording() {
      try {
        const stream = await navigator.mediaDevices.getDisplayMedia({
          video: true,
          audio: true
        });

        const hasAudio = stream.getAudioTracks().length > 0;
        if (!hasAudio) {
          alert("âš ï¸ KhÃ´ng phÃ¡t hiá»‡n Ã¢m thanh! HÃ£y chá»n tab trÃ¬nh duyá»‡t vÃ  báº­t 'Chia sáº» Ã¢m thanh tab'.");
        }

        document.getElementById("preview").srcObject = stream;

        recordedChunks = [];
        mediaRecorder = new MediaRecorder(stream);

        mediaRecorder.ondataavailable = (e) => {
          if (e.data.size > 0) recordedChunks.push(e.data);
        };

        mediaRecorder.onstop = () => {
          const blob = new Blob(recordedChunks, { type: "video/webm" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = "screen-recording.webm";
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);

          // Dá»«ng stream
          document.getElementById("preview").srcObject.getTracks().forEach(track => track.stop());
          document.getElementById("preview").srcObject = null;
        };

        mediaRecorder.start();
        document.querySelector('button[onclick="startRecording()"]').disabled = true;
        document.getElementById("stopBtn").disabled = false;
      } catch (err) {
        alert("ğŸš« Lá»—i khi báº¯t Ä‘áº§u quay mÃ n hÃ¬nh: " + err.message);
      }
    }

    function stopRecording() {
      mediaRecorder.stop();
      document.querySelector('button[onclick="startRecording()"]').disabled = false;
      document.getElementById("stopBtn").disabled = true;
    }
  </script>
</body>
</html>
